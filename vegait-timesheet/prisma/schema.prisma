generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// ENUMS
// ============================================

enum UserRole {
  ADMIN
  EMPLOYEE

  @@map("user_role")
}

// ============================================
// USER & AUTHENTICATION
// ============================================

model User {
  id        String     @id @default(cuid())
  username  String     @unique
  password  String
  firstName String
  lastName  String
  roles     UserRole[] // Array of roles (can have multiple)
  timeLogs  TimeLog[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("users")
}

// ============================================
// REFERENCE DATA
// ============================================

model Industry {
  id        String    @id @default(cuid())
  name      String    @unique
  projects  Project[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("industries")
}

model TimeLogCategory {
  id        String    @id @default(cuid())
  name      String    @unique
  timeLogs  TimeLog[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("time_log_categories")
}

// ============================================
// MAIN ENTITIES
// ============================================

model Client {
  id          String    @id @default(cuid())
  name        String
  address     String
  countryCode String    @db.Char(2) // ISO 2-letter code (e.g., "US", "RS", "GB")
  projects    Project[]
  timeLogs    TimeLog[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([countryCode])
  @@index([name])
  @@map("clients")
}

model Project {
  id         String    @id @default(cuid())
  name       String
  clientId   String
  client     Client    @relation(fields: [clientId], references: [id], onDelete: Restrict)
  industryId String
  industry   Industry  @relation(fields: [industryId], references: [id], onDelete: Restrict)
  timeLogs   TimeLog[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([clientId])
  @@index([industryId])
  @@map("projects")
}

// ============================================
// TIME TRACKING
// ============================================

model TimeLog {
  id          String          @id @default(cuid())
  date        DateTime        @db.Date
  hours       Decimal         @db.Decimal(4, 1)
  description String?         @db.Text
  userId      String
  user        User            @relation(fields: [userId], references: [id], onDelete: Restrict)
  clientId    String
  client      Client          @relation(fields: [clientId], references: [id], onDelete: Restrict)
  projectId   String
  project     Project         @relation(fields: [projectId], references: [id], onDelete: Restrict)
  categoryId  String
  category    TimeLogCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([date])
  @@index([userId])
  @@index([clientId])
  @@index([projectId])
  @@index([categoryId])
  @@map("time_logs")
}